/*!
 *  angular-google-maps-native
 *  Version   : 1.0.0
 *  Date      : 2015-06-20
 *  Author    : DEMONTE Jean-Baptiste
 *  Contact   : jbdemonte@gmail.com
 *  Licence   : GPL v3 : http://www.gnu.org/licenses/gpl.html
 */
!function(n){"use strict";function e(n){return(n.ngShow?"("+n.ngShow+")":"")+(n.ngHide?(n.ngShow?" && ":"")+"!("+n.ngHide+")":"")||""}function t(e,t){var i=t?e:null;return e instanceof c.LatLng?i=e:n.isArray(e)?i=new c.LatLng(e[0],e[1]):n.isObject(e)&&"lat"in e&&(i=new c.LatLng(e.lat,e.lng)),i}function i(e){var i,r;return!e||e instanceof c.LatLngBounds?e||null:(n.isArray(e)?2===e.length?(i=t(e[0]),r=t(e[1])):4===e.length&&(i=t([e[0],e[1]]),r=t([e[2],e[3]])):"ne"in e&&"sw"in e?(i=t(e.ne),r=t(e.sw)):"n"in e&&"e"in e&&"s"in e&&"w"in e&&(i=t([e.n,e.e]),r=t([e.s,e.w])),i&&r?new c.LatLngBounds(r,i):null)}function r(n){return n+="",n.charAt(0).toUpperCase()+n.substr(1)}function o(n,e){var t;return function(){return n&&(t=n.apply(e||this,arguments),n=null),t}}function a(n){return n.replace(/([a-z0-9])([A-Z])/g,"$1_$2").replace(/^[^_]+_/,"").toLowerCase()}var c,u;u=function(){var n={};return function(e){return!n.hasOwnProperty(e)&&c[e]&&(n[e]=new c[e]),n[e]}}(),n.module("GoogleMapsNative",[]).provider("gmLibrary",function(){function e(){var e=a.url,t=e.indexOf("?");return-1===t?e+="?":t===e.length-1&&(e+="&"),n.forEach(a,function(n,t){-1===o.indexOf(t)&&(e+=t+"="+n+"&")}),a.libraries.length&&(e+="libraries="+a.libraries.join(",")),e}function t(n,t){var o,u=a.callback;return r||(r=!0,i=t.defer(),n[u]=function(){if(delete n[u],c=google.maps,!c)throw"google.maps library not found";i.resolve()},o=document.createElement("script"),o.type="text/javascript",o.src=e(),document.body.appendChild(o)),i.promise}var i,r=!1,o=["url","libraries"],a={url:"https://maps.googleapis.com/maps/api/js",v:3,libraries:[],language:"en",sensor:"false",callback:"__mapLibraryLoaded"};this.configure=function(e){n.extend(a,e)},this.$get=["$window","$q",function(n,e){return{populate:function(n){n.google=google},load:function(){return t(n,e)}}}]}).factory("gmTools",["$parse","$timeout",function(e,t){return{bind:function(i,r,o){n.forEach(o,function(n,o){var u=o.match(/^on(ce)?[A-Z]/);u&&c.event["addListener"+(u[1]?"Once":"")](i,a(o),function(i){t(function(){r.$apply(function(){var t=r.$new(!1);t.event=i,e(n)(t)})})})})},watch:function(e,t,i,o,a,c){n.forEach(o.split(" "),function(o){var u,s=o.toLowerCase();s&&s in t&&(u=e.$watch(t[s],function(e){n.isDefined(e)&&(c&&u(),i.then(function(n){n["set"+r(o)](a?a(e):e)}))}))})}}}]).factory("gmLogger",function(){return{error:function(){console.error.apply(console,arguments)}}}).directive("gmMap",["$q","$timeout","$parse","gmLibrary","gmLogger","gmTools",function(i,r,a,u,s,l){return{restrict:"E",scope:!0,controller:["$scope","$element","$attrs",function(e,t,a){var s,f=i.defer(),m=n.element(document.createElement("DIV"));t.css("position")||t.css("position","relative"),m.css({position:"absolute",top:0,right:0,bottom:0,left:0}),t.append(m),this._build=o(function(n,t){r(function(){s=new c.Map(m[0],t),e.map=s,l.bind(s,e,a),f.resolve(s)},100)}),this.then=function(n){f.promise.then(n)},this.get=function(){return s},u.load().then(function(){u.populate(e)})}],link:function(n,i,o,f){function m(a){var u=e(o);u?n.$watch(u,function(n){if(n){var e=f.get();e?r(function(){c.event.trigger(e,"resize")}):f._build(i,a)}}):f._build(i,a),"center"in o&&f.then(function(){l.watch(n,o,f,"center",t)})}function d(){var e={};return o.options&&(e=a(o.options)(n),e.center&&(e.center=t(e.center))),e.center||"center"in o?(e.center?m(e):l.watch(n,o,f,"center",function(n){e.center=t(n),m(e)},!0),l.watch(n,o,f,"heading tilt zoom",function(n){return 1*n}),void l.watch(n,o,f,"mapTypeId")):s.error("center not defined")}u.load().then(d)}}}]).service("gmOverlayBuilder",["$q","$timeout","$parse","gmTools","gmLogger",function(t,i,r,a,u){return{builder:function(i){var s=[i.directive];return n.isArray(i.require)?Array.prototype.push.apply(s,i.require):i.require&&n.isString(i.require)&&s.push(i.require),s.push("^gmMap"),{restrict:"E",scope:!0,require:s,controller:["$scope","$element","$attrs",function(n,e,r){var u,s=t.defer();n.$on("$destroy",function(){u?(i.destroy?i.destroy(n,e,r,u):u.setMap(null),u=null):s.reject()}),this._build=o(function(e){u=new c[i.cls](e),i.name&&(n[i.name]=u),a.bind(u,n,r),s.resolve(u)}),this.then=function(n){s.promise.then(n)},this.get=function(){return u}}],link:function(n,t,o,c){function s(r){var u=e(o);u?n.$watch(u,function(e){var a=f.get();a?i.visibility?i.visibility(n,t,o,c,e):a.setMap(e?m.get():null):(!e&&r.map&&delete r.map,f._build(r),i.visibility&&i.visibility(n,t,o,c,e))}):f._build(r),i.main&&i.main.name in o&&f.then(function(){a.watch(n,o,f,i.main.name,i.main.cast)})}function l(e){var l={};if(o.options&&(l=r(o.options)(n),i.main&&l[i.main.name]&&(l[i.main.name]=i.main.cast(l[i.main.name]))),!i.create||!i.create(n,t,o,c,l,s))if(l.map=e,l[i.main.name])s(l);else{if(!(i.main.name in o))return u.error(i.main.name+" not defined for "+i.directive);a.watch(n,o,f,i.main.name,function(n){l[i.main.name]=i.main.cast?i.main.cast(n):n,s(l)},!0)}}var f=c[0],m=c[c.length-1];m.then(l)}}}}}]).directive("gmMarker",["gmOverlayBuilder",function(n){return n.builder({directive:"gmMarker",name:"marker",cls:"Marker",main:{name:"position",cast:t}})}]).directive("gmCircle",["gmOverlayBuilder",function(n){return n.builder({directive:"gmCircle",name:"circle",cls:"Circle",main:{name:"center",cast:t}})}]).directive("gmRectangle",["gmOverlayBuilder",function(n){return n.builder({directive:"gmRectangle",name:"rectangle",cls:"Rectangle",main:{name:"bounds",cast:i}})}]).directive("gmInfowindow",["$parse","gmOverlayBuilder",function(n,e){return e.builder({directive:"gmInfowindow",require:["^?gmMarker"],name:"infowindow",cls:"InfoWindow",main:{name:"position",cast:t},destroy:function(n,e,t,i){i.close()},create:function(n,e,t,i,r,o){return i[1]?(i[1].then(function(n){r.anchor=n,o(r)}),!0):!1},visibility:function(n,e,t,i,r){var o=i[0].get(),a=i[1],c=i[2];return r?void o.open(c.get(),a?a.get():null):o.close()}})}]).directive("gmDirections",["$q","$timeout","$parse",function(e,i,r){return{restrict:"E",scope:!0,require:["gmDirections","^gmMap"],controller:["$scope",function(n){var i=e.defer(),r={result:null,status:""};this._run=function(e){e.origin=t(e.origin,!0),e.destination=t(e.destination,!0),u("DirectionsService").route(e,function(e,t){r.result=e,r.status=t,n.$apply(function(){n.directions={result:e,status:t}}),i.resolve(r)})},this.then=function(n){i.promise.then(n)},this.get=function(){return r}}],link:function(e,t,i,o){function a(){function t(){var e=!0;return n.forEach(o,function(n){e=e&&a[n]}),e}var o=["origin","destination","travelMode"],a={};i.options&&(a=r(i.options)(e)),t()&&c._run(a),n.forEach(o,function(r){r in i&&e.$watch(r,function(e){n.isDefined(e)&&(a[r]=e,t()&&c._run(a))})})}var c=o[0],u=o[1];u.then(a)}}}]).directive("gmRenderer",["$parse","gmOverlayBuilder",function(n,e){return e.builder({directive:"gmRenderer",name:"directionsRenderer",cls:"DirectionsRenderer",require:["^gmDirections"],create:function(n,e,t,i,r,o){var a=i[0],c=i[1],u=i[2];return c.then(function(e){r.map=u.get(),r.directions=e.result,n.$watch("directions",function(n){a.get().setDirections(n.result)}),o(r)}),!0}})}])}(angular);