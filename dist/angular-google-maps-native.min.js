/*!
 *  angular-google-maps-native
 *  Version   : 1.2.0
 *  Date      : 2015-07-09
 *  Author    : DEMONTE Jean-Baptiste
 *  Contact   : jbdemonte@gmail.com
 *  Licence   : GPL v3 : http://www.gnu.org/licenses/gpl.html
 */
!function(n){"use strict";function e(n){return(n.ngShow?"("+n.ngShow+")":"")+(n.ngHide?(n.ngShow?" && ":"")+"!("+n.ngHide+")":"")||""}function t(e,t){var i=t?e:null;return e instanceof c.LatLng?i=e:n.isArray(e)?i=new c.LatLng(e[0],e[1]):n.isObject(e)&&"lat"in e&&(i=new c.LatLng(e.lat,e.lng)),i}function i(e){var i,r;return!e||e instanceof c.LatLngBounds?e||null:(n.isArray(e)?2===e.length?(i=t(e[0]),r=t(e[1])):4===e.length&&(i=t([e[0],e[1]]),r=t([e[2],e[3]])):"ne"in e&&"sw"in e?(i=t(e.ne),r=t(e.sw)):"n"in e&&"e"in e&&"s"in e&&"w"in e&&(i=t([e.n,e.e]),r=t([e.s,e.w])),i&&r?new c.LatLngBounds(r,i):null)}function r(n){return n+="",n.charAt(0).toUpperCase()+n.substr(1)}function o(n,e){var t;return function(){return n&&(t=n.apply(e||this,arguments),n=null),t}}function a(n){return n.replace(/([a-z0-9])([A-Z])/g,"$1_$2").replace(/^[^_]+_/,"").toLowerCase()}var c,u;u=function(){var n={};return function(e){return!n.hasOwnProperty(e)&&c[e]&&(n[e]=new c[e]),n[e]}}(),n.module("GoogleMapsNative",[]).provider("gmLibrary",function(){function e(){var e=a.url,t=e.indexOf("?");return-1===t?e+="?":t===e.length-1&&(e+="&"),n.forEach(a,function(n,t){-1===o.indexOf(t)&&(e+=t+"="+n+"&")}),a.libraries.length&&(e+="libraries="+a.libraries.join(",")),e}function t(n,t,o){var u,l=a.callback;return r||(r=!0,i=o.defer(),t[l]=function(){if(delete t[l],c=t.google.maps,!c)throw"google.maps library not found";i.resolve()},u=n[0].createElement("script"),u.type="text/javascript",u.src=e(),n.find("body").append(u)),i.promise}var i,r=!1,o=["url","libraries"],a={url:"https://maps.googleapis.com/maps/api/js",v:3,libraries:[],language:"en",sensor:"false",callback:"__mapLibraryLoaded"};this.configure=function(e){n.extend(a,e)},this.$get=["$document","$window","$rootScope","$q",function(n,e,i,r){return{populate:function(n){n.google=google,i.google=google},load:function(){return t(n,e,r)}}}]}).factory("gmTools",["$parse","$timeout","gmLogger",function(e,t,i){var o={bind:function(i,r,o){n.forEach(o,function(n,o){var u=o.match(/^on(ce)?[A-Z]/);u&&c.event["addListener"+(u[1]?"Once":"")](i,a(o),function(i){t(function(){r.$apply(function(){var t=r.$new(!1);t.event=i,e(n)(t)})})})})},watch:function(e,t,i,r,o,a){n.forEach(r.split(" "),function(i){var r,c=i.toLowerCase();c in t&&(r=e.$watch(t[c],function(e){n.isDefined(e)&&(a&&r(),o(e,i))}))})},prop:function(n,e,t,i,a,c){o.watch(n,e,t,i,function(n,e){t.then(function(t){t["set"+r(e)](a?a(n):n)})},c)},wait:function(t,r,o,a,c,u){function l(){var e=!0;return n.forEach(f,function(n){e=e&&m[n]}),e}var s=[],f=a.split(" "),m={};r.options&&(m=e(r.options)(t)),l()&&c(m),u&&l()||n.forEach(f,function(e){var o=e.toLowerCase();o in r?s.push(t.$watch(r[o],function(t){n.isDefined(t)&&(m[e]=t,l()&&(u&&n.forEach(s,function(n){n()}),c(m)))})):n.isDefined(m[e])||i.error(e+" not defined")})}};return o}]).factory("gmLogger",function(){return{error:function(){console.error.apply(console,arguments)}}}).directive("gmMap",["$q","$timeout","$parse","gmLibrary","gmTools",function(i,r,a,u,l){return{restrict:"E",scope:!0,controller:["$scope","$element","$attrs",function(e,t,a){var s,f=i.defer(),m=n.element(document.createElement("DIV"));t.css("position")||t.css("position","relative"),m.css({position:"absolute",top:0,right:0,bottom:0,left:0}),t.append(m),this._build=o(function(n,t){r(function(){s=new c.Map(m[0],t),e.map=s,l.bind(s,e,a),f.resolve(s)},100)}),this.then=function(n){f.promise.then(n)},this.get=function(){return s},u.load().then(function(){u.populate(e)})}],link:function(n,i,o,a){function s(t){var u=e(o);u?n.$watch(u,function(n){if(n){var e=a.get();e?r(function(){c.event.trigger(e,"resize")}):a._build(i,t)}}):a._build(i,t)}u.load().then(function(){l.wait(n,o,a,"center zoom",function(e){e.center=t(e.center),e.zoom=1*e.zoom,s(e),l.prop(n,o,a,"center",t),l.prop(n,o,a,"mapTypeId"),l.prop(n,o,a,"heading tilt zoom",function(n){return 1*n})},!0)})}}}]).service("gmOverlayBuilder",["$q","$timeout","$parse","gmTools",function(t,i,r,a){return{builder:function(i){var u=[i.directive];return n.isArray(i.require)?Array.prototype.push.apply(u,i.require):i.require&&n.isString(i.require)&&u.push(i.require),u.push("^gmMap"),{restrict:"E",scope:!0,require:u,controller:["$scope","$element","$attrs",function(n,e,r){var u,l=t.defer();n.$on("$destroy",function(){u?(i.destroy?i.destroy(n,e,r,u):u.setMap(null),u=null):l.reject()}),this._build=o(function(t,o,s){var f=i.opts?t.opts||{}:t;!s&&f.map&&delete f.map,u=i.instantiate?i.instantiate(n,e,r,t):new c[i.cls](t),s&&!f.map&&u.setMap&&u.setMap(o),i.name&&(n[i.name]=u),a.bind(u,n,r),l.resolve(u)}),this.then=function(n){l.promise.then(n)},this.get=function(){return u}}],link:function(n,t,o,c){function u(r){var a=e(o),u=s.get();a?n.$watch(a,function(e){var a=l.get();a?i.visibility?i.visibility(n,t,o,c,e):a.setMap(e?u:null):(l._build(r,u,e),i.visibility&&i.visibility(n,t,o,c,e))}):l._build(r,u,!0)}var l=c[0],s=c[c.length-1];s.then(function(e){var s={};i.create&&(o.options&&(s=r(o.options)(n),i.main&&s[i.main.name]&&(s[i.main.name]=i.main.cast(s[i.main.name]))),i.create(n,t,o,c,s,u))||a.wait(n,o,l,i.main.name,function(t){i.main.cast&&(t[i.main.name]=i.main.cast(t[i.main.name])),i.opts?(t.opts=t.opts||{},t.opts.map=e):t.map=e,u(t),a.prop(n,o,l,i.main.name,i.main.cast)})})}}}}}]).directive("gmMarker",["gmOverlayBuilder",function(n){return n.builder({directive:"gmMarker",name:"marker",cls:"Marker",main:{name:"position",cast:t}})}]).directive("gmCircle",["gmOverlayBuilder",function(n){return n.builder({directive:"gmCircle",name:"circle",cls:"Circle",main:{name:"center",cast:t}})}]).directive("gmRectangle",["gmOverlayBuilder",function(n){return n.builder({directive:"gmRectangle",name:"rectangle",cls:"Rectangle",main:{name:"bounds",cast:i}})}]).directive("gmInfowindow",["$parse","gmOverlayBuilder","gmTools",function(n,e,i){return e.builder({directive:"gmInfowindow",require:["^?gmMarker"],name:"infowindow",cls:"InfoWindow",main:{name:"position",cast:t},destroy:function(n,e,t,i){i.close()},create:function(n,e,r,o,a,c){var u=o[0],l=o[1],s=o[2],f=function(n){c(n),r.ngShow||r.ngHide||u.then(function(n){n.open(s.get(),l?l.get():null)})};return l?l.then(function(){f(a)}):i.wait(n,r,o[0],"position",function(e){e.position=t(e.position),f(e),i.prop(n,r,o[0],"position",t)},!0),!0},visibility:function(n,e,t,i,r){var o=i[0].get(),a=i[1],c=i[2];return r?void o.open(c.get(),a?a.get():null):o.close()}})}]).directive("gmDirections",["$q","$timeout","$parse","gmTools",function(n,e,i,r){return{restrict:"E",scope:!0,require:["gmDirections","^gmMap"],controller:["$scope",function(e){var i=n.defer(),r={result:null,status:""};this._run=function(n){n.origin=t(n.origin,!0),n.destination=t(n.destination,!0),u("DirectionsService").route(n,function(n,t){r.result=n,r.status=t,e.$apply(function(){e.directions={result:n,status:t}}),i.resolve(r)})},this.then=function(n){i.promise.then(n)},this.get=function(){return r}}],link:function(n,e,t,i){var o=i[0],a=i[1];a.then(function(){r.wait(n,t,o,"origin destination travelMode",function(n){o._run(n)})})}}}]).directive("gmRenderer",["$parse","gmOverlayBuilder",function(n,e){return e.builder({directive:"gmRenderer",name:"renderer",cls:"DirectionsRenderer",require:["^gmDirections"],create:function(n,e,t,i,r,o){var a=i[0],c=i[1],u=i[2];return c.then(function(e){r.map=u.get(),r.directions=e.result,n.$watch("directions",function(n){a.get().setDirections(n.result)}),o(r)}),!0}})}]).directive("gmPolyline",["gmOverlayBuilder",function(e){return e.builder({directive:"gmPolyline",name:"polyline",cls:"Polyline",main:{name:"path",cast:function(e){return n.forEach(e,function(n,i){e[i]=t(n)}),e}}})}]).directive("gmPolygon",["gmOverlayBuilder",function(e){return e.builder({directive:"gmPolygon",name:"polygon",cls:"Polygon",main:{name:"paths",cast:function(e){return n.forEach(e,function(n,i){e[i]=t(n)}),e}}})}]).directive("gmGroundoverlay",["$parse","gmOverlayBuilder","gmTools",function(n,e,t){return e.builder({directive:"gmGroundoverlay",name:"groundOverlay",cls:"GroundOverlay",opts:!0,instantiate:function(n,e,t,i){return new c.GroundOverlay(i.url,i.bounds,i.opts)},create:function(n,e,r,o,a,c){return o[1].then(function(){t.wait(n,r,o[0],"url bounds",function(n){n.bounds=i(n.bounds),c(n)},!0)}),!0}})}]).directive("gmKmllayer",["$parse","gmOverlayBuilder",function(n,e){return e.builder({directive:"gmKmllayer",name:"kmlLayer",cls:"KmlLayer",opts:!0,main:{name:"url"},instantiate:function(n,e,t,i){return new c.KmlLayer(i.url,i.opts)}})}]).service("gmLayerBuilder",["gmOverlayBuilder",function(e){return{builder:function(t){return e.builder(n.extend({create:function(n,e,t,i,r,o){return t.ngShow||t.ngHide||i[0].then(function(n){n.setMap(i[1].get())}),o(r),!0}},t))}}}]).directive("gmTrafficlayer",["gmLayerBuilder",function(n){return n.builder({directive:"gmTrafficlayer",name:"trafficLayer",cls:"TrafficLayer"})}]).directive("gmBicyclinglayer",["gmLayerBuilder",function(n){return n.builder({directive:"gmBicyclinglayer",name:"bicyclingLayer",cls:"BicyclingLayer"})}])}(angular);